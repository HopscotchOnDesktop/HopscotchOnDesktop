using Microsoft.Web.WebView2.Core;
using Microsoft.Win32;
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using System.Web;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;

namespace HS
{
    /// <summary>
    /// Interaction logic for Edit.xaml
    /// </summary>
    public partial class Edit : Window
    {
        Dictionary<int, string> blockColors = new Dictionary<int, string>
        {
            { 23, "#d73e1e" },
            { 24, "#d73e1e" },
            { 26, "#a6006e" },
            { 27, "#d73e1e" },
            { 28, "#d73e1e" },
            { 30, "#a6006e" },
            { 31, "#a6006e" },
            { 32, "#a6006e" },
            { 33, "#63ae1e" },
            { 34, "#d73e1e" },
            { 35, "#3e83be" },
            { 39, "#d73e1e" },
            { 40, "#63ae1e" },
            { 41, "#d73e1e" },
            { 42, "#63ae1e" },
            { 43, "#63ae1e" },
            { 44, "#e7b601" },
            { 45, "#e7b601" },
            { 47, "#63ae1e" },
            { 48, "#63ae1e" },
            { 49, "#63ae1e" },
            { 50, "#d73e1e" },
            { 51, "#63ae1e" },
            { 52, "#63ae1e" },
            { 53, "#3e83be" },
            { 54, "#63ae1e" },
            { 55, "#3e83be" },
            { 56, "#63ae1e" },
            { 57, "#63ae1e" },
            { 58, "#63ae1e" },
            { 59, "#d73e1e" },
            { 60, "#d73e1e" },
            { 61, "#3e83be" },
            { 62, "#63ae1e" },
            { 63, "#e7b601" },
            { 64, "#63ae1e" },
            { 65, "#63ae1e" },
            { 66, "#63ae1e" },
            { 67, "#63ae1e" },
            { 68, "#3e83be" },
            { 69, "#3e83be" },
            { 70, "#63ae1e" },
            { 71, "#a6006e" },
            { 72, "#63ae1e" },
            { 73, "#a6006e" },
            { 120, "#3e83be" },
            { 121, "#3e83be" },
            { 122, "#3e83be" },
            { 124, "#3e83be" },
            { 125, "#3e83be" },
            { 126, "#3e83be" },
            { 127, "#3e83be" }
        };

        public Edit(string id)
        {
            InitializeComponent();
            //display("138o34zhv8");
            display(id);
        }

        public async void display(string uuid)
        {
            await codeviewer.EnsureCoreWebView2Async();
            codeviewer.WebMessageReceived += ReceiveProjectData;
            // Astronaut Loader From Uiverse.io by JkHuger
            codeviewer.NavigateToString(@"<!DOCTYPE html><html><head><style>body{background-color:#000000; overflow:hidden;}@keyframes snow{ 0%{ opacity:0; transform:translateY(0px); }20%{ opacity:1; }100%{ opacity:1; transform:translateY(650px); }}@keyframes astronaut{ 0%{ transform:rotate(0deg); }100%{ transform:rotate(360deg); }}.box-of-star1,.box-of-star2,.box-of-star3,.box-of-star4{ width:100%; position:absolute; z-index:10; left:0; top:0; transform:translateY(0px); height:700px;}.box-of-star1{ animation:snow 5s linear infinite;}.box-of-star2{ animation:snow 5s -1.64s linear infinite;}.box-of-star3{ animation:snow 5s -2.30s linear infinite;}.box-of-star4{ animation:snow 5s -3.30s linear infinite;}.star{ width:3px; height:3px; border-radius:50%; background-color:#FFF; position:absolute; z-index:10; opacity:0.7;}.star:before{ content:""""; width:6px; height:6px; border-radius:50%; background-color:#FFF; position:absolute; z-index:10; top:80px; left:70px; opacity:.7;}.star:after{ content:""""; width:8px; height:8px; border-radius:50%; background-color:#FFF; position:absolute; z-index:10; top:8px; left:170px; opacity:.9;}.star-position1{ top:30px; left:20px;}.star-position2{ top:110px; left:250px;}.star-position3{ top:60px; left:570px;}.star-position4{ top:120px; left:900px;}.star-position5{ top:20px; left:1120px;}.star-position6{ top:90px; left:1280px;}.star-position7{ top:30px; left:1480px;}.astronaut{ width:250px; height:300px; position:absolute; z-index:11; top:calc(50% - 150px); left:calc(50% - 125px); animation:astronaut 5s linear infinite;}.schoolbag{ width:100px; height:150px; position:absolute; z-index:1; top:calc(50% - 75px); left:calc(50% - 50px); background-color:#94b7ca; border-radius:50px 50px 0 0 / 30px 30px 0 0;}.head{ width:97px; height:80px; position:absolute; z-index:3; background:-webkit-linear-gradient(left,#e3e8eb 0%,#e3e8eb 50%,#fbfdfa 50%,#fbfdfa 100%); border-radius:50%; top:34px; left:calc(50% - 47.5px);}.head:after{ content:""""; width:60px; height:50px; position:absolute; top:calc(50% - 25px); left:calc(50% - 30px); background:-webkit-linear-gradient(top,#15aece 0%,#15aece 50%,#0391bf 50%,#0391bf 100%); border-radius:15px;}.head:before{ content:""""; width:12px; height:25px; position:absolute; top:calc(50% - 12.5px); left:-4px; background-color:#618095; border-radius:5px; box-shadow:92px 0px 0px #618095;}.body{ width:85px; height:100px; position:absolute; z-index:2; background-color:#fffbff; border-radius:40px / 20px; top:105px; left:calc(50% - 41px); background:-webkit-linear-gradient(left,#e3e8eb 0%,#e3e8eb 50%,#fbfdfa 50%,#fbfdfa 100%);}.panel{ width:60px; height:40px; position:absolute; top:20px; left:calc(50% - 30px); background-color:#b7cceb;}.panel:before{ content:""""; width:30px; height:5px; position:absolute; top:9px; left:7px; background-color:#fbfdfa; box-shadow:0px 9px 0px #fbfdfa,0px 18px 0px #fbfdfa;}.panel:after{ content:""""; width:8px; height:8px; position:absolute; top:9px; right:7px; background-color:#fbfdfa; border-radius:50%; box-shadow:0px 14px 0px 2px #fbfdfa;}.arm{ width:80px; height:30px; position:absolute; top:121px; z-index:2;}.arm-left{ left:30px; background-color:#e3e8eb; border-radius:0 0 0 39px;}.arm-right{ right:30px; background-color:#fbfdfa; border-radius:0 0 39px 0;}.arm-left:before,.arm-right:before{ content:""""; width:30px; height:70px; position:absolute; top:-40px;}.arm-left:before{ border-radius:50px 50px 0px 120px / 50px 50px 0 110px; left:0; background-color:#e3e8eb;}.arm-right:before{ border-radius:50px 50px 120px 0 / 50px 50px 110px 0; right:0; background-color:#fbfdfa;}.arm-left:after,.arm-right:after{ content:""""; width:30px; height:10px; position:absolute; top:-24px;}.arm-left:after{ background-color:#6e91a4; left:0;}.arm-right:after{ right:0; background-color:#b6d2e0;}.leg{ width:30px; height:40px; position:absolute; z-index:2; bottom:70px;}.leg-left{ left:76px; background-color:#e3e8eb; transform:rotate(20deg);}.leg-right{ right:73px; background-color:#fbfdfa; transform:rotate(-20deg);}.leg-left:before,.leg-right:before{ content:""""; width:50px; height:25px; position:absolute; bottom:-26px;}.leg-left:before{ left:-20px; background-color:#e3e8eb; border-radius:30px 0 0 0; border-bottom:10px solid #6d96ac;}.leg-right:before{ right:-20px; background-color:#fbfdfa; border-radius:0 30px 0 0; border-bottom:10px solid #b0cfe4;}</style></head><body><div class=box-of-star1><div class=""star star-position1""></div><div class=""star star-position2""></div><div class=""star star-position3""></div><div class=""star star-position4""></div><div class=""star star-position5""></div><div class=""star star-position6""></div><div class=""star star-position7""></div></div><div class=box-of-star2><div class=""star star-position1""></div><div class=""star star-position2""></div><div class=""star star-position3""></div><div class=""star star-position4""></div><div class=""star star-position5""></div><div class=""star star-position6""></div><div class=""star star-position7""></div></div><div class=box-of-star3><div class=""star star-position1""></div><div class=""star star-position2""></div><div class=""star star-position3""></div><div class=""star star-position4""></div><div class=""star star-position5""></div><div class=""star star-position6""></div><div class=""star star-position7""></div></div><div class=box-of-star4><div class=""star star-position1""></div><div class=""star star-position2""></div><div class=""star star-position3""></div><div class=""star star-position4""></div><div class=""star star-position5""></div><div class=""star star-position6""></div><div class=""star star-position7""></div></div><div data-js=astro class=astronaut><div class=head></div><div class=""arm arm-left""></div><div class=""arm arm-right""></div><div class=body><div class=panel></div></div><div class=""leg leg-left""></div><div class=""leg leg-right""></div><div class=schoolbag></div></div></body></html>");
            var client = new HttpClient();
            var request = new HttpRequestMessage(HttpMethod.Get, "https://c.gethopscotch.com/api/v1/projects/" + uuid);
            var response = await client.SendAsync(request);
            dynamic projectJSON = JsonConvert.DeserializeObject(await response.Content.ReadAsStringAsync());
            string htmlvars = "";
            for (int varc = 0; varc < projectJSON.variables.Count; varc++)
            {
                htmlvars += @"<div class=""--var-container""><div class=""--var"" var-color=""#e7b601"" var-desc=""" + projectJSON.variables[varc].name + @""" onclick=""setvar(event)"" data-id=""" + projectJSON.variables[varc].objectIdString + @"""></div></div>";
            }
            string cssimgreplace = @":root {--a1: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAAAXNSR0IArs4c6QAAESRJREFUeF7t122KkFcMBWDHLYhWd+tu/cItOGWgU6RUpaf0Njfn6Z+iQ3iTJ3EO9+GF/wgQIECAQCDwENQoIUCAAAECLwSIIyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQECAuAECBAgQiAQESMSmiAABAgQEiBsgQIAAgUhAgERsiggQIEBAgLgBAgQIEIgEBEjEpogAAQIEBIgbIECAAIFIQIBEbIoIECBAQIC4AQIECBCIBARIxKaIAAECBASIGyBAgACBSECARGyKCBAgQGBNgHz8/PXROgkQIHCDwNs3r1b87l0xxNPBCJAb/tnokQCBJwEBMuwOBMiwhWiHAIEfCgiQYcchQIYtRDsECAiQW25AgNyyKX0SIOAFMuwGBMiwhWiHAAEvkFtuQIDcsil9EiDgBTLsBgTIsIVohwABL5BbbkCA3LIpfRIg4AUy7AYEyLCFaIcAAS+QW25AgNyyKX0SIOAFMuwGBMiwhWiHAAEvkFtuQIDcsil9EiDgBTLsBgTIsIVohwABL5BbbkCA3LIpfRIg4AUy7AYEyLCFaIcAAS+QW25AgNyyKX0SIOAFMuwGBMiwhWiHAAEvkFtuQIDcsil9EiDgBTLsBgTIsIVohwABL5BbbkCA3LIpfRIg4AUy7AYEyLCFaIcAAS+QW25AgNyyKX0SIOAFMuwGBMiwhWiHAAEvkFtuQIDcsil9EiDgBeIGCBAgQKBa4KF6esMTIECAQCwgQGI6hQQIEOgWECDd+zc9AQIEYgEBEtMpJECAQLeAAOnev+kJECAQCwiQmE4hAQIEugUESPf+TU+AAIFYQIDEdAoJECDQLSBAuvdvegIECMQCAiSmU0iAAIFuAQHSvX/TEyBAIBYQIDGdQgIECHQLCJDu/ZueAAECsYAAiekUEiBAoFtAgHTv3/QECBCIBQRITKeQAAEC3QICpHv/pidAgEAsIEBiOoUECBDoFhAg3fs3PQECBGIBARLTKSRAgEC3gADp3r/pCRAgEAsIkJhOIQECBLoFBEj3/k1PgACBWECAxHQKCRAg0C0gQLr3b3oCBAjEAgIkplNIgACBbgEB0r1/0xMgQCAWECAxnUICBAh0CwiQ7v2bngABArGAAInpFBIgQKBbQIB079/0BAgQiAUESEynkAABAt0CAqR7/6YnQIBALCBAYjqFBAgQ6BYQIN37Nz0BAgRiAQES0ykkQIBAt4AA6d6/6QkQIBALCJCYTiEBAgS6BQRI9/5NT4AAgVhAgMR0CgkQINAtIEC69296AgQIxAICJKZTSIAAgW4BAdK9f9MTIEAgFhAgMZ1CAgQIdAsIkO79m54AAQKxgACJ6RQSIECgW0CAdO/f9AQIEIgFBEhMp5AAAQLdAgKke/+mJ0CAQCwgQGI6hQQIEOgWECDd+zc9AQIEYgEBEtMpJECAQLeAAOnev+kJECAQCwiQmE4hAQIEugUESPf+TU+AAIFYQIDEdAoJECDQLSBAuvdvegIECMQCAiSmU0iAAIFuAQHSvX/TEyBAIBYQIDGdQgIECHQLCJDu/ZueAAECscCaAPnw6cv7WEEhAQIEDgq8++31it9XawLk4+evjwf371MECBCIBd6+ebXid++KIZ62KEDiW1ZIgMBhAQFyGPxXnxMgvxLycwIEpggIkCmb+KMPATJsIdohQOCHAgJk2HEIkGEL0Q4BAgLklhsQILdsSp8ECHiBDLsBATJsIdohQMAL5JYbECC3bEqfBAh4gQy7AQEybCHaIUDAC+SWGxAgt2xKnwQIeIEMuwEBMmwh2iFAwAvklhsQILdsSp8ECHiBDLsBATJsIdohQMAL5JYbECC3bEqfBAh4gQy7AQEybCHaIUDAC+SWGxAgt2xKnwQIeIEMuwEBMmwh2iFAwAvklhsQILdsSp8ECHiBDLsBATJsIdohQMAL5JYbECC3bEqfBAh4gQy7AQEybCHaIUDAC+SWGxAgt2xKnwQIeIEMuwEBMmwh2iFAwAvklhsQILdsSp8ECHiBDLuBD5++vB/WknYuF3j58uXj8wjfvn17ePrz0/+f/+7559//3fcj/5uf/5/ffprhZ73/07n+zu3Z7Fem/8XPv//206w/+/PP9v2zuZ4N/1r//Od3v71e8fvqz38Ml/9b1z4BAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVAgGzZpDkIECBwWECAHAb3OQIECGwRECBbNmkOAgQIHBYQIIfBfY4AAQJbBATIlk2agwABAocFBMhhcJ8jQIDAFgEBsmWT5iBAgMBhAQFyGNznCBAgsEVgTYB8/Pz1cctSzEGAwG6Bt29erfjdu2KIp1MTILv/wZmOwCYBATJsmwJk2EK0Q4DADwUEyLDjECDDFqIdAgQEyC03IEBu2ZQ+CRDwAhl2AwJk2EK0Q4CAF8gtNyBAbtmUPgkQ8AIZdgMCZNhCtEOAgBfILTcgQG7ZlD4JEPACGXYDAmTYQrRDgIAXyC03IEBu2ZQ+CRDwAhl2AwJk2EK0Q4CAF8gtNyBAbtmUPgkQ8AIZdgMCZNhCtEOAgBfILTcgQG7ZlD4JEPACGXYDAmTYQrRDgIAXyC03IEBu2ZQ+CRDwAhl2AwJk2EK0Q4CAF8gtNyBAbtmUPgkQ8AIZdgMCZNhCtEOAgBfILTcgQG7ZlD4JEPACGXYDAmTYQrRDgIAXyC03IEBu2ZQ+CRDwAhl2AwJk2EK0Q4CAF8gtNyBAbtmUPgkQ8AJxAwQIECBQLfBQPb3hCRAgQCAWECAxnUICBAh0CwiQ7v2bngABArGAAInpFBIgQKBbQIB079/0BAgQiAUESEynkAABAt0CAqR7/6YnQIBALCBAYjqFBAgQ6BYQIN37Nz0BAgRiAQES0ykkQIBAt4AA6d6/6QkQIBALCJCYTiEBAgS6BQRI9/5NT4AAgVhAgMR0CgkQINAtIEC69296AgQIxAICJKZTSIAAgW4BAdK9f9MTIEAgFhAgMZ1CAgQIdAsIkO79m54AAQKxgACJ6RQSIECgW0CAdO/f9AQIEIgFBEhMp5AAAQLdAgKke/+mJ0CAQCwgQGI6hQQIEOgWECDd+zc9AQIEYgEBEtMpJECAQLeAAOnev+kJECAQCwiQmE4hAQIEugUESPf+TU+AAIFYQIDEdAoJECDQLSBAuvdvegIECMQCAiSmU0iAAIFuAQHSvX/TEyBAIBYQIDGdQgIECHQLCJDu/ZueAAECsYAAiekUEiBAoFtAgHTv3/QECBCIBQRITKeQAAEC3QICpHv/pidAgEAsIEBiOoUECBDoFhAg3fs3PQECBGIBARLTKSRAgEC3gADp3r/pCRAgEAsIkJhOIQECBLoFBEj3/k1PgACBWECAxHQKCRAg0C0gQLr3b3oCBAjEAgIkplNIgACBbgEB0r1/0xMgQCAWECAxnUICBAh0CwiQ7v2bngABArGAAInpFBIgQKBbQIB079/0BAgQiAUESEynkAABAt0CAqR7/6YnQIBALCBAYjqFBAgQ6BYQIN37Nz0BAgRiAQES0ykkQIBAt4AA6d6/6QkQIBALCJCYTiEBAgS6BQRI9/5NT4AAgVhAgMR0CgkQINAtIEC69296AgQIxAICJKZTSIAAgW4BAdK9f9MTIEAgFhAgMZ1CAgQIdAsIkO79m54AAQKxgACJ6RQSIECgW0CAdO/f9AQIEIgFBEhMp5AAAQLdAgKke/+mJ0CAQCwgQGI6hQQIEOgWECDd+zc9AQIEYgEBEtMpJECAQLeAAOnev+kJECAQCwiQmE4hAQIEugUESPf+TU+AAIFYQIDEdAoJECDQLSBAuvdvegIECMQCAiSmU0iAAIFuAQHSvX/TEyBAIBYQIDGdQgIECHQLCJDu/ZueAAECsYAAiekUEiBAoFtAgHTv3/QECBCIBQRITKeQAAEC3QICpHv/pidAgEAsIEBiOoUECBDoFhAg3fs3PQECBGIBARLTKSRAgEC3gADp3r/pCRAgEAsIkJhOIQECBLoFBEj3/k1PgACBWECAxHQKCRAg0C0gQLr3b3oCBAjEAgIkplNIgACBbgEB0r1/0xMgQCAWECAxnUICBAh0CwiQ7v2bngABArHA73ZoraDtpBf0AAAAAElFTkSuQmCC');}img#blockdraggable {content: var(--a1);}";
            string drawer = @"<div class=""--block --block-global"" id=""global-block"" style=""display:none"" block-data=""""><span>Global</span><img id=""blockdraggable"" src=""icon.png"" draggable=""false""></div><div class=""--scroller-container""><div class=""--scroller-flex"" id=""blocks-drawer""><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;23&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Move Forward&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;100&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Move Forward""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;24&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Turn&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;degrees&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;90&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Turn""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;41&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Position&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;200&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Set Position""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;50&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Flip&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Flip""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;27&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Change X by&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;100&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Change X by""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;28&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Change Y by&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;100&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Change Y by""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;34&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Speed&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;1000&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Set Speed""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;39&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Angle&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;30&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Set Angle""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:rgb(215,62,30)&quot; block-class=&quot;method&quot; block-type=&quot;59&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:rgb(215,62,30)&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Origin&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;to x&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;200&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""rgb(215,62,30)"" block-desc=""Set Origin""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;70&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Background&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;97.25&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Background""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;54&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Color&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;97.25&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Color""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data="""" block-color=""#63ae1e"" block-desc=""!! Set Image""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;40&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Text&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;53&quot;&gt;&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;42&quot;&gt;97.25&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Text""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;51&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Size&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;percent&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;110&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Size""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;57&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;200&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Width and Height""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;48&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Grow by&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;percent&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;50&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Grow by""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;49&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Shrink by&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;percent&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;50&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Shrink by""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data="""" block-color=""#63ae1e"" block-desc=""!! Start Sound""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;47&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Invisibility&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;percent&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;50&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Invisibility""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;43&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Bring to Front&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Bring to Front""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;42&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Send to Back&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Send to Back""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;33&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Change Pose&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Change Pose""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;72&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Show Pop-up&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;53&quot;&gt;The message to show&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Show Pop-up""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#63ae1e&quot; block-class=&quot;method&quot; block-type=&quot;64&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#63ae1e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Text to Input&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;param&quot; specific-type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;44&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;44&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;44&quot;&gt;97.25&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;prompt&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;53&quot;&gt;Type here&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#63ae1e"" block-desc=""Set Text to Input""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block _block temp&quot; style=&quot;background-color:#ffffff&quot; block-class=&quot;method&quot; block-type=&quot;26&quot;&gt;&lt;div class=&quot;block-title&quot; style=&quot;background-color:#a6006e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Draw a Trail&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;param&quot; specific-type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;172&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;86&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;96&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;10&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div class=&quot;block-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Placeholder&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#a6006e"" block-desc=""Draw a Trail""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#a6006e&quot; block-class=&quot;method&quot; block-type=&quot;32&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#a6006e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Trail Color&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;param&quot; specific-type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;172&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;86&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;96&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#a6006e"" block-desc=""Set Trail Color""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#a6006e&quot; block-class=&quot;method&quot; block-type=&quot;31&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#a6006e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set Trail Width&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;param&quot; specific-type=&quot;44&quot;&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;172&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;86&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;96&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#a6006e"" block-desc=""Set Trail Width""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#a6006e&quot; block-class=&quot;method&quot; block-type=&quot;30&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#a6006e&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Clear&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#a6006e"" block-desc=""Clear""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#e7b601&quot; block-class=&quot;method&quot; block-type=&quot;45&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#e7b601&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;var&quot; specific-type=&quot;47&quot;&gt;Placeholder&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;48&quot;&gt;10&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#e7b601"" block-desc=""Set""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#e7b601&quot; block-class=&quot;method&quot; block-type=&quot;44&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#e7b601&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Increase&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;var&quot; specific-type=&quot;47&quot;&gt;Placeholder&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;48&quot;&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#e7b601"" block-desc=""Increase""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#e7b601&quot; block-class=&quot;method&quot; block-type=&quot;63&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#e7b601&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Save Input&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;var&quot; specific-type=&quot;47&quot;&gt;Placeholder&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;prompt&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;53&quot;&gt;type here&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#e7b601"" block-desc=""Save Input""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block _block temp&quot; style=&quot;background-color:#ffffff&quot; block-class=&quot;method&quot; block-type=&quot;122&quot;&gt;&lt;div class=&quot;block-title&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Check Once If&lt;/span&gt;&lt;span class=&quot;param&quot; specific-type=&quot;49&quot; type=&quot;cond&quot;&gt;PlaceholderCond&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div class=&quot;block-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Placeholder&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Check Once If""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block _block temp&quot; style=&quot;background-color:#ffffff&quot; block-class=&quot;method&quot; block-type=&quot;120&quot;&gt;&lt;div class=&quot;block-title&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Repeat&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;times&lt;/span&gt;&lt;span class=&quot;param&quot; specific-type=&quot;57&quot; type=&quot;editable&quot;&gt;5&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div class=&quot;block-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Placeholder&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Repeat""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data="""" block-color=""#3e83b3"" block-desc=""!! Check If Else""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block _block temp&quot; style=&quot;background-color:#ffffff&quot; block-class=&quot;method&quot; block-type=&quot;121&quot;&gt;&lt;div class=&quot;block-title&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Repeat Forever&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div class=&quot;block-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#d4d4d4&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Placeholder&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Repeat Forever""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;61&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;seconds&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;0.5&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Wait""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;35&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Wait Milliseconds&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;57&quot;&gt;500&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Wait Milliseconds""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;53&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Create a Clone&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Create a Clone""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;55&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Destroy&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Destroy""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;68&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Open Project&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;62&quot;&gt;-1&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Open Project""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;69&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;55&quot; textonly&gt;Comment&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Comment""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data="""" block-color=""#3e83b3"" block-desc=""!! Change Scene""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div><div class=""--block-container""><div class=""--block"" block-data=""&lt;div class=&quot;block-block temp&quot; style=&quot;background-color:#3e83b3&quot; block-class=&quot;method&quot; block-type=&quot;126&quot;&gt;&lt;div class=&quot;block-title-block&quot; style=&quot;background-color:#3e83b3&quot;&gt;&lt;p&gt;&lt;span class=&quot;name&quot;&gt;Broadcast Message&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;named&lt;/span&gt;&lt;span class=&quot;param&quot; type=&quot;editable&quot; specific-type=&quot;53&quot;&gt;Message&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"" block-color=""#3e83b3"" block-desc=""Broadcast Message""><span></span><img id=""blockdraggable"" src=""icon.png"" onmousedown=""dragElement(event)"" draggable=""false""></div></div></div></div><div class=""--scroller-container"" id=""vars-drawer-container"" style=""display:none""><div class=""--scroller-flex"" id=""vars-drawer""><table class=""numpad""><tr><td><div class=""num""><span>1</span></div></td><td><div class=""num""><span>2</span></div></td><td><div class=""num""><span>3</span></div></td></tr><tr><td><div class=""num""><span>4</span></div></td><td><div class=""num""><span>5</span></div></td><td><div class=""num""><span>6</span></div></td></tr><tr><td><div class=""num""><span>7</span></div></td><td><div class=""num""><span>8</span></div></td><td><div class=""num""><span>9</span></div></td></tr><tr><td><div class=""num""><span></span></div></td><td><div class=""num""><span>0</span></div></td><td><div class=""num""><span></span></div></td></tr></table>" + htmlvars + @"</div></div><div class=""--scroller-container"" id=""rules-drawer-container"" style=""display:none""><div class=""--scroller-flex"" id=""rules-drawer""><div class=""--rule-container""><div class=""--rule"" rule-color=""#e7b601"" rule-desc=""When Game Starts"" onclick=""setrule(event)"" data-id=""hello"" data=""Game Starts""></div></div><div class=""--rule-container""><div class=""--rule"" rule-color=""#e7b601"" rule-desc=""When"" onclick=""setrule(event)"" data-id=""helloworld"" data=""testing""></div></div></div></div>";
            string startHTML = @"<!DOCTYPE html><html><head><style>" + cssimgreplace + @" *{user-select:none}.--scroller-container{height:210px;width:100vw;overflow-x:overlay;overflow-y:hidden;background-color:#d4d4d4;bottom:0;left:0;position:fixed;z-index:100}.--scroller-flex{height:210px;width:fit-content;display:flex;flex-direction:column;flex-wrap:wrap}.--block-container{height:70px;width:200px}.--block,.--var{align-items:center;height:40px}.--block{background:purple;padding:5px;margin:10px;border-radius:15px;display:inline-grid;width:170px;grid-auto-flow:column;position:absolute}.--rule,.--var{background:purple;padding:5px;margin:10px;border-radius:50px;display:inline-grid;grid-auto-flow:column;position:absolute;overflow:hidden;font-family:Arial,Helvetica,sans-serif;font-size:20px}.--var{width:100px;justify-content:center}.--var-container{height:70px;width:130px}.--rule{align-items:center;height:40px;width:200px;justify-content:center}.--rule-container{height:70px;width:230px}.--block-global{background:red;z-index:150;margin:0}.--block>span{font-size:20px;font-family:Arial,Helvetica,sans-serif;margin-left:10px;width:fit-content}.--block>img{margin-left:auto;margin-right:0;height:30px;width:30px}.container{width:100vw;height:100vh;max-width:100%;max-height:100%;margin:0;padding:0}.block,.block-block{overflow:hidden;margin:10px}.block-title,.block-title-block{background-color:red;padding:10px;display:flex}.temp{border:4px solid #3e83be}.block{min-height:100px;border:2px solid #000;border-radius:15px}.block-block{min-height:40px;border:2px solid #000;border-radius:15px}.block-title{min-height:40px;justify-content:center;flex-direction:column;margin-bottom:10px}.block-title-block{min-height:40px;justify-content:center;flex-direction:column}.key,.param{display:inline-block}.block-title-block>p,.block-title>p{margin:0;font-size:20px;font-family:arial;overflow-x:scroll;white-space:nowrap;user-select:none;-ms-overflow-style:none;scrollbar-width:none}.block-title-block>p::-webkit-scrollbar,.block-title>p::-webkit-scrollbar{display:none}.name{margin-right:5px}.param{background-color:#fff;padding:0 5px;border-radius:25px;border:2px solid #000}.key{padding:0 10px}.scene{background-color:#d4d4d4}.object{background-color:#6bdaed}.rule{background-color:#be2961}._block{background-color:#fff}.numpad{background-color:#d4d4d4;width:150px;height:200px;table-layout:fixed;margin-top:auto;margin-bottom:auto;margin-left:4px}table.numpad td{padding:5px 2.5px}.num{align-items:center;justify-content:center;width:100%;height:35px;background-color:#fff;display:grid;border-radius:5px;box-shadow:0 5px 5px -2.5px #add8e6}.num span{background-color:#565656;font-family:Arial;font-weight:600;font-size:20px;color:transparent;text-shadow:0 1px 1.5px rgba(255,255,255,.8);-webkit-background-clip:text;-moz-background-clip:text;background-clip:text;line-height:1;display:inline}.num:active{transform:translateY(2px)}.savebtn{position:fixed;top:10px;right:10px;border:none;background-color:rgba(128,128,128,.8);color:#fff;width:50px;height:50px}.savebtn:hover{box-shadow:0 0 5px 5px rgba(62,131,190,.8)}</style></head><body onmousemove=""moveMouse(event)"" onmouseup=""mouseUp(event)""><div class=""container"">";
            string endHTML = drawer + @"</div><button class=""savebtn"" onclick=""toJSON()"">Save</button><script>var pv = """ + projectJSON.playerVersion + @"""; var v = """ + projectJSON.version + @"""; Array.from(document.getElementsByClassName(""num"")).forEach(e=>e.onclick=function(){numClick(e.children[0].innerHTML)}),Array.from(document.getElementsByClassName(""--block"")).forEach(e=>{e.style.backgroundColor=e.getAttribute(""block-color""),e.children[0].innerHTML=e.getAttribute(""block-desc"")}),Array.from(document.getElementsByClassName(""--var"")).forEach(e=>{e.style.backgroundColor=e.getAttribute(""var-color""),e.innerHTML=e.getAttribute(""var-desc"")}),Array.from(document.getElementsByClassName(""--rule"")).forEach(e=>{e.style.backgroundColor=e.getAttribute(""rule-color""),e.innerHTML=e.getAttribute(""rule-desc"")}),load();var isDown=!1,readonly=!1;function load(){readonly||Array.from(document.getElementsByClassName(""param"")).forEach(e=>{""block""==e.getAttribute(""type"")&&e.setAttribute(""contenteditable"",""true"")}),Array.from(document.getElementsByClassName(""param"")).forEach(e=>{e.hasAttribute(""original-value"")||e.setAttribute(""original-value"",e.innerHTML),""var""==e.getAttribute(""type"")?e.onclick=function(){chooseVariable(event)}:""rule""==e.getAttribute(""type"")&&(e.onclick=function(){chooseRule(event)})})}var selectedParam=null;function chooseVariable(e){e.target.style.border=""4px solid #3e83be"",selectedParam=e.target,document.getElementById(""vars-drawer-container"").style.display=""""}function chooseRule(e){e.target.style.border=""4px solid #3e83be"",selectedParam=e.target,document.getElementById(""rules-drawer-container"").style.display=""""}function setvar(e){""var""==selectedParam.getAttribute(""type"")?(selectedParam.innerHTML=e.target.getAttribute(""var-desc""),selectedParam.setAttribute(""data-id"",e.target.getAttribute(""data-id""))):(selectedParam.setAttribute(""type"",""var""),selectedParam.innerHTML=e.target.getAttribute(""var-desc""),selectedParam.setAttribute(""data-id"",e.target.getAttribute(""data-id"")))}function setrule(e){alert(""Rule selections are not supported yet :("")}function mouseUp(e){if(load(),window.innerHeight-e.clientY>210){console.log(e.clientY);try{document.getElementById(""vars-drawer-container"").style.display=""none"",document.getElementById(""rules-drawer-container"").style.display=""none"",selectedParam.style.border=null}catch(t){console.log(t)}}isDown=!1,document.getElementById(""global-block"").style.display=""none"",Array.from(document.getElementsByClassName(""temp"")).forEach(e=>{e.classList.remove(""temp"")}),readonly||Array.from(document.getElementsByClassName(""param"")).forEach(e=>{""editable""==e.getAttribute(""type"")&&e.setAttribute(""contenteditable"",""true"")})}function dragElement(e){var t=e.target.parentNode.getBoundingClientRect();console.log(t),document.getElementById(""global-block"").style.left=t.left+window.scrollX+""px"",document.getElementById(""global-block"").style.top=t.top+window.scrollY+""px"",isDown=!0,document.getElementById(""global-block"").children[0].innerHTML=e.target.parentNode.getAttribute(""block-desc""),document.getElementById(""global-block"").style.backgroundColor=e.target.parentNode.getAttribute(""block-color""),document.getElementById(""global-block"").setAttribute(""block-data"",e.target.parentNode.getAttribute(""block-data"")),document.getElementById(""global-block"").style.display=""inline-grid""}function moveMouse(e){if(isDown){e.target=document.getElementsByTagName(""body"")[0],document.getElementById(""global-block"").style.left=e.clientX+window.scrollX+""px"",document.getElementById(""global-block"").style.top=e.clientY+window.scrollY+""px"";var t=null,r=null;Array.from(document.getElementsByClassName(""temp"")).forEach(e=>{e.remove()}),Array.from(document.querySelectorAll("".block, .block-block"")).forEach(e=>{doElsCollide(e,document.getElementById(""global-block""))&&(t=e,r=collideSide(e,document.getElementById(""global-block"")))}),null!=t&&(p=toNodes(document.getElementById(""global-block"").getAttribute(""block-data"")),console.log(document.getElementById(""global-block"").getAttribute(""block-data"")),1==r?t.parentNode.insertBefore(p,t.parentNode.children.item(Array.from(t.parentNode.children).indexOf(t)+1)):t.parentNode.insertBefore(p,t))}}function numClick(e){e=e.trim(),""editable""==selectedParam.getAttribute(""type"")?selectedParam.innerHTML+=e:(selectedParam.setAttribute(""type"",""editable""),selectedParam.setAttribute(""specific-type"",""57""),selectedParam.innerHTML=e)}doElsCollide=function(e,t){return e.offsetBottom=e.offsetTop+e.offsetHeight,e.offsetRight=e.offsetLeft+e.offsetWidth,t.offsetBottom=t.offsetTop+t.offsetHeight,t.offsetRight=t.offsetLeft+t.offsetWidth,!(e.offsetBottom<t.offsetTop||e.offsetTop>t.offsetBottom||e.offsetRight<t.offsetLeft||e.offsetLeft>t.offsetRight)},collideSide=function(e,t){return(e.offsetBottom=e.offsetTop+e.offsetHeight,t.offsetBottom=t.offsetTop+t.offsetHeight,e.offsetBottom<t.offsetBottom)?1:e.offsetBottom>t.offsetBottom?2:void 0};var variables=[];const toNodes=e=>new DOMParser().parseFromString(e,""text/html"").body.childNodes[0];function toJSON(){var e={scenes:[],objects:[],rules:[],abilities:[]};Array.from(document.querySelectorAll("".block .scene"")).forEach(t=>{t=t.parentNode;var r={name:"""",objects:[]};r.name=t.children[0].children[0].children[0].innerHTML;var l=!1;Array.from(t.children).forEach(t=>{if(l){var o=JSON.parse(t.getAttribute(""data""));o.rules.length=0,r.objects.push(o.objectID);var a=!1;Array.from(t.children).forEach(t=>{if(a){var r,l={ruleBlockType:6e3,id:"""",abilityID:"""",objectID:"""",name:"""",parameters:[],type:6e3};l.objectID=o.objectID,l.id=t.getAttribute(""rule-id""),o.rules.push(l.id);var i=!1;Array.from(t.children[0].children[0].children).forEach(e=>{i?l.parameters=getparams(t):i=!0});var s={abilityID:"""",createdAt:528310318.27146,blocks:[]};s.abilityID=t.getAttribute(""ability-id""),Array.from(t.children).forEach(t=>{if(r){var l={block_class:"""",type:null,description:""""};(l.description=t.children[0].children[0].children[0].innerHTML,t.childElementCount>1)?(l.block_class=""control"",l.type=Number(t.getAttribute(""block-type"")),l.parameters=getparams(t),l.controlScript={abilityID:t.getAttribute(""control-script"")},Array.from(generateAbility(t.getAttribute(""control-script""),t)).forEach(t=>e.abilities.push(t))):(l.block_class=""method"",l.type=Number(t.getAttribute(""block-type"")),l.parameters=getparams(t)),s.blocks.push(l)}else r=!0}),e.abilities.push(s),l.abilityID=s.abilityID,e.rules.push(l)}else a=!0}),e.objects.push(o)}else l=!0}),e.scenes.push(r)}),e.variables=variables,e.playerVersion=pv,e.version=v,console.log(JSON.stringify(e)),window.chrome.webview.postMessage(JSON.stringify(e))}function getparams(e,t){var r="""",l=[];if(t)o=e.children;else var o=e.children[0].children[0].children;return Array.from(o).forEach(e=>{var t={defaultValue:"""",value:"""",key:"""",type:null};if(e.classList.contains(""key""))r=e.innerHTML;else if(e.classList.contains(""param"")){switch(e.getAttribute(""type"")){case""editable"":t.defaultValue=e.getAttribute(""original-value""),t.value=e.innerHTML,t.key=r,t.type=Number(e.getAttribute(""specific-type""));break;case""var"":if(e.hasAttribute(""trait-id"")){var o={};o.HSTraitTypeKey=e.getAttribute(""trait-type""),o.HSTraitIDKey=e.getAttribute(""trait-id""),o.HSTraitObjectParameterTypeKey=e.getAttribute(""trait-object-type""),o.description=e.innerHTML,t.datum=o,t.type=42}else{var o={};if(o.type=Number(e.getAttribute(""var-type"")),o.description=e.innerHTML,o.variable=e.getAttribute(""data-id""),t.datum=o,t.type=e.getAttribute(""specific-type""),47==e.getAttribute(""specific-type"")){console.warn(e);var a={};a.name=e.innerHTML,a.type=Number(e.getAttribute(""var-type"")),e.closest("".object""),a.objectIdString=e.getAttribute(""data-id"");var i=!0;variables.forEach(e=>{e.objectID==a.objectID&&e.name==a.name&&(i=!1)}),i&&variables.push(a)}}break;case""rule"":t.type=Number(e.getAttribute(""specific-type""));var o={};o.type=Number(e.getAttribute(""datum-type"")),o.block_class=""operator"",o.description=e.innerHTML,t.datum=o}if(e.childElementCount>0){t.description="""";var o={};o.type=Number(e.getAttribute(""specific-type"")),o.description="""",o.block_class=""operator"",o.params=getparams(e,!0),t.datum=o}else console.log(""nothit"");l.push(t),r=""""}}),l}function generateAbility(e,t){var r,l=[],o={abilityID:"""",createdAt:528310318.27146,blocks:[]};return o.abilityID=e,Array.from(t.children).forEach(e=>{if(r){var t={block_class:"""",type:null,description:""""};(t.description=e.children[0].children[0].children[0].innerHTML,e.childElementCount>1)?(t.block_class=""control"",t.type=Number(e.getAttribute(""block-type"")),t.parameters=getparams(e),t.controlScript={abilityID:e.getAttribute(""control-script"")},Array.from(generateAbility(e.getAttribute(""control-script""),e)).forEach(e=>{l.push(e)})):(t.block_class=""method"",t.type=Number(e.getAttribute(""block-type"")),t.parameters=getparams(e)),o.blocks.push(t)}else r=!0}),l.push(o),l}</script></body></html>";
            string middleHTML = "";

            for (int a = 0; a < projectJSON.scenes.Count; a++)
            {
                middleHTML += @"<div class=""block scene""><div class=""block-title scene""><p><span class=""name"">" + projectJSON.scenes[a].name + "</span></p></div>";
                for (int b = 0; b < projectJSON.scenes[a].objects.Count; b++)
                {
                    string objectid = projectJSON.scenes[a].objects[b];

                    for (int b1 = 0; b1 < projectJSON.objects.Count; b1++)
                    {
                        if (projectJSON.objects[b1].objectID == objectid)
                        {
                            middleHTML += @"<div class=""block object"" data=""" + HttpUtility.HtmlEncode(projectJSON.objects[b1].ToString()) + @"""><div class=""block-title object""><p><span class=""name"">" + projectJSON.objects[b1].name + "</span></p></div>";
                            for (int c = 0; c < projectJSON.objects[b].rules.Count; c++)
                            {
                                string ruleid = projectJSON.objects[b].rules[c];

                                for (int c1 = 0; c1 < projectJSON.rules.Count; c1++)
                                {
                                    if (projectJSON.rules[c1].id == ruleid)
                                    {
                                        string blocktype = "";
                                        switch (projectJSON.rules[c1].ruleBlockType.ToString())
                                        {
                                            case "6000":
                                                blocktype = "When";
                                                break;
                                        }
                                        string abilityid = projectJSON.rules[c1].abilityID;
                                        middleHTML += @"<div class=""block rule"" rule-id=""" + ruleid + @""" ability-id=""" + abilityid + @"""><div class=""block-title rule""><p><span class=""name"">" + blocktype + @"</span>" + getParamHTML(projectJSON.rules[c1].parameters, projectJSON) + @"</p></div>";
                                        middleHTML += displayAbility(abilityid, projectJSON);
                                        middleHTML += @"</div>";
                                    }
                                }
                            }
                            middleHTML += @"</div>";
                        }
                    }
                }
                middleHTML += @"</div>";
            }
            string HTML = startHTML + middleHTML + endHTML;
            codeviewer.NavigateToString(HTML);
        }

        void ReceiveProjectData(object sender, CoreWebView2WebMessageReceivedEventArgs args)
        {
            String json = args.TryGetWebMessageAsString();
            ReadOnlyMemory<byte> project = Encoding.UTF8.GetBytes(json);

            SaveFileDialog saveFileDialog1 = new SaveFileDialog();
            saveFileDialog1.FileName = "test.hopscotch";
            saveFileDialog1.Filter = "Hopscotch File|*.hopscotch";
            saveFileDialog1.Title = "Save a Hopscotch File";
            saveFileDialog1.ShowDialog();

            if (saveFileDialog1.FileName != "")
            {
                System.IO.FileStream fs =
                    (System.IO.FileStream)saveFileDialog1.OpenFile();
                using (StreamWriter outputFile = new StreamWriter(fs))
                {
                    outputFile.Write(json);
                }
            }
        }

        public string displayAbility(string abilityid, dynamic projectJSON)
        {
            string html = "";
            for (int d1 = 0; d1 < projectJSON.abilities.Count; d1++)
            {
                if (projectJSON.abilities[d1].abilityID == abilityid)
                {
                    // ability
                    for (int e1 = 0; e1 < projectJSON.abilities[d1].blocks.Count; e1++)
                    {
                        if (projectJSON.abilities[d1].blocks[e1].ContainsKey("controlScript"))
                        {
                            html += @"<div class=""block _block"" control-script=""" + projectJSON.abilities[d1].blocks[e1].controlScript.abilityID + @""" block-type=""" + projectJSON.abilities[d1].blocks[e1].type + @"""><div class=""block-title"" style=""background-color:" + getBlockColor(projectJSON.abilities[d1].blocks[e1].type) + @"""><p><span class=""name"">" + projectJSON.abilities[d1].blocks[e1].description + @"</span>" + getParamHTML(projectJSON.abilities[d1].blocks[e1].parameters, projectJSON) + @"</p></div>";
                            html += displayAbility(projectJSON.abilities[d1].blocks[e1].controlScript.abilityID.ToString(), projectJSON);
                            html += @"</div>";
                        }
                        else
                        {
                            html += @"<div class=""block-block"" block-type=""" + projectJSON.abilities[d1].blocks[e1].type + @""" style=""background-color:" + getBlockColor(projectJSON.abilities[d1].blocks[e1].type) + @"""><div class=""block-title-block"" style=""background-color:" + getBlockColor(projectJSON.abilities[d1].blocks[e1].type) + @"""><p><span class=""name"">" + projectJSON.abilities[d1].blocks[e1].description + @"</span>" + getParamHTML(projectJSON.abilities[d1].blocks[e1].parameters, projectJSON) + @"</p></div>";
                            html += @"</div>";
                        }
                    }
                }
            }
            return html;
        }

        public string getBlockColor(dynamic type)
        {
            type = Convert.ToInt32(type);
            if (blockColors.ContainsKey(type))
            {
                return blockColors[type];
            }
            else
            {
                return "#647f96";
            }
        }

        public string getParamHTML(dynamic @params, dynamic project)
        {
            if (@params != null)
            {
                string html = "";
                foreach (dynamic param in @params)
                {
                    if (param.ContainsKey("datum"))
                    {
                        if (param.datum.type >= 7000 && param.datum.type < 8000)
                        {
                            // rule param
                            html += @"<span class=""param"" type=""rule"" specific-type=""" + param.type + @""" datum-type=""" + param.datum.type + @""">";
                            html += getParamHTML(param.datum.@params, project);
                            html += " " + param.datum.description;
                            html += @"</span>";
                        }
                        else if (param.datum.ContainsKey("params"))
                        {
                            // param that contains other params
                            html += @"<span class=""key"">" + param.key + "</span>";
                            html += @"<span class=""param"" type=""var"" specific-type=""" + param.datum.type + @""">" + getParamHTML(param.datum.@params, project) + "</span>";
                        }
                        else if (param.datum.ContainsKey("variable"))
                        {
                            bool found = false;
                            for (int var = 0; var < project.variables.Count; var++)
                            {
                                if (project.variables[var].objectIdString.ToString() == param.datum.variable.ToString())
                                {
                                    found = true;
                                    html += @"<span class=""key"">" + param.key + "</span>";
                                    html += @"<span class=""param"" type=""var"" var-type=""" + project.variables[var].type + @""" specific-type=""" + param.type + @""" data-id=""" + param.datum.variable + @""">" + project.variables[var].name + @"</span>";
                                }
                            }
                            if (!found)
                            {
                                for (int eventParameters = 0; eventParameters < project.eventParameters.Count; eventParameters++)
                                {
                                    if (project.eventParameters[eventParameters].id.ToString() == param.datum.variable.ToString())
                                    {
                                        found = true;
                                        html += @"<span class=""key"">" + param.key + "</span>";
                                        html += @"<span class=""param"" type=""var"" var-type=""" + project.eventParameters[eventParameters].blockType + @""" specific-type=""" + param.type + @""" data-id=""" + param.datum.variable + @""">" + project.eventParameters[eventParameters].description + project.datum.description + @"</span>";
                                    }
                                }
                            }
                        }
                        else
                        {
                            // hs trait
                            html += @"<span class=""key"">" + param.key + @"</span><span class=""param"" specific-type=""" + param.type + @""" type=""var"" trait-type=""" + param.datum.HSTraitTypeKey + @""" trait-object-type=""" + param.datum.HSTraitObjectParameterTypeKey + @""" trait-id=""" + param.datum.HSTraitIDKey + @""">" + param.datum.description + @"</span>";
                        }
                    }
                    else if (param.ContainsKey("variable"))
                    {
                        bool found = false;
                        for (int var = 0; var < project.variables.Count; var++)
                        {
                            if (project.variables[var].objectIdString.ToString() == param.variable.ToString())
                            {
                                found = true;
                                html += @"<span class=""key"">" + param.key + "</span>";
                                html += @"<span class=""param"" type=""var"" var-type=""" + project.variables[var].type + @""" specific-type=""" + param.type + @""" data-id=""" + param.datum.variable + @""">" + project.variables[var].name + @"</span>";
                            }
                        }
                        if (!found)
                        {
                            for (int eventParameters = 0; eventParameters < project.eventParameters.Count; eventParameters++)
                            {
                                if (project.eventParameters[eventParameters].id.ToString() == param.variable.ToString())
                                {
                                    found = true;
                                    html += @"<span class=""key"">" + param.key + "</span>";
                                    html += @"<span class=""param"" type=""var"" var-type=""" + project.eventParameters[eventParameters].blockType + @""" specific-type=""" + param.type + @""" data-id=""" + param.datum.variable + @""">" + project.eventParameters[eventParameters].description + @"</span>";
                                }
                            }
                        }
                    }
                    else
                    {
                        html += @"<span class=""key"">" + param.key + @"</span><span class=""param"" type=""editable"" specific-type=""" + param.type + @""">" + param.value + @"</span>";
                    }
                }
                return html;
            }
            else
            {
                return "";
            }
        }
    }
}
